# ------------------------------
# Crypto Orderflow MCP - .env example
# Copy to .env and edit values.
# ------------------------------

# ------------------------------
# MCP server
# ------------------------------
MCP_HOST=0.0.0.0
MCP_PORT=8022
LOG_LEVEL=INFO

# (Recommended for remote CherryStudio)
# If you connect through a public IP / domain / reverse-proxy, set a reachable URL here.
# This value is used in the legacy /sse handshake (endpoint event) so the client POSTs to the correct address.
# Example:
# MCP_PUBLIC_URL=http://YOUR_PUBLIC_IP:8022
MCP_PUBLIC_URL=

# Legacy SSE keepalive ping interval (seconds)
# (Shorter pings reduce disconnects for some remote SSE clients.)
MCP_SSE_PING_INTERVAL_SEC=10

# ------------------------------
# Binance endpoints
# ------------------------------
BINANCE_REST_URL=https://fapi.binance.com
BINANCE_WS_URL=wss://fstream.binance.com

# API key/secret are optional for most public endpoints.
# If you do not need authenticated endpoints, leave them empty.
BINANCE_API_KEY=
BINANCE_API_SECRET=

# ------------------------------
# Symbols
# ------------------------------
SYMBOLS=BTCUSDT

# ------------------------------
# Database
# ------------------------------
# For systemd deployment, use an absolute path.
CACHE_DB_PATH=./data/orderflow_cache.db
DATA_RETENTION_DAYS=7

# ------------------------------
# Sessions (UTC)
# ------------------------------
# Exocharts "Main sessions" (non-overlapping 4 blocks)
# Format: NAME=HH:MM-HH:MM,...
SESSIONS=A=00:00-06:00,L=06:00-12:00,N=12:00-20:00,E=20:00-00:00

# Legacy overlapping sessions (only used if you explicitly set SESSIONS=)
# TOKYO_SESSION=00:00-09:00
# LONDON_SESSION=07:00-16:00
# NY_SESSION=13:00-22:00

# ------------------------------
# Orderflow / footprint settings
# ------------------------------
DEFAULT_TIMEFRAME=1m
FOOTPRINT_TICK_SIZE_BTC=0.1
FOOTPRINT_TICK_SIZE_ETH=0.01
IMBALANCE_RATIO_THRESHOLD=3.0
IMBALANCE_CONSECUTIVE_LEVELS=3
# ------------------------------
# TPO / Market Profile defaults
# ------------------------------
# Default period length for TPO analysis (used by get_tpo_profile)
# Common: 30m
TPO_INTERVAL=30m

# TPO price step (row size) in quote units.
# Exocharts example shows e.g. "T * 70"; for BTCUSDT this typically maps to ~50-70 USDT per row.
# Adjust to match your chart / preference.
TPO_TICK_SIZE_BTC=70.0
TPO_TICK_SIZE_ETH=5.0

# Match Exocharts option: "Use VOLUME for TPO POC+VA calculation"
# Exocharts: "Use VOLUME for TPO POC+VA calculation" (recommended ON for crypto)
TPO_USE_VOLUME_FOR_VA_DEFAULT=true


# ------------------------------
# Orderbook settings
# ------------------------------
ORDERBOOK_DEPTH_PERCENT=1.0
ORDERBOOK_UPDATE_INTERVAL_SEC=5
ORDERBOOK_SNAPSHOT_LIMIT=1000

# ------------------------------
# Liquidations
# ------------------------------
LIQUIDATION_CACHE_SIZE=1000

# ------------------------------
# Rate limiting / reconnect
# ------------------------------
REST_RATE_LIMIT_PER_MIN=600
WS_RECONNECT_DELAY_SEC=5
WS_MAX_RECONNECT_ATTEMPTS=10

# ------------------------------
# Historical backfill (strongly recommended)
# ------------------------------
BACKFILL_ENABLED=true
BACKFILL_LOOKBACK_HOURS=60
# TIP: Use >= 48 hours if you want complete previous-day (pd*) levels at any time of day.
# Backfill data source:
#   auto   = prefer Binance Vision for completed UTC days, fallback to REST for intraday
#   vision = only use Binance Vision for completed UTC days (fallback to REST if file missing)
#   rest   = always use Binance REST /fapi/v1/aggTrades (may hit 429)
BACKFILL_SOURCE=auto

# Public data mirror used by BACKFILL_SOURCE=auto/vision
BINANCE_VISION_BASE_URL=https://data.binance.vision
VISION_CACHE_DIR=./data/binance_vision_cache
BACKFILL_MAX_REQUESTS_PER_SYMBOL=0
# If true, **block** server startup until backfill completes.
# - Pros: tools have history immediately (no partial session profiles right after restart)
# - Cons: startup can take time (especially with BACKFILL_REBUILD=true and long LOOKBACK)
# Recommended:
#   - First install / big upgrade: set true + BACKFILL_REBUILD=true, start once, wait for completion
#   - Normal operation: set false so the server is reachable immediately
BACKFILL_BLOCK_STARTUP=false
# Force rebuild of days in range. Recommended on first install, after upgrading,
# or whenever you suspect the cache is incomplete/corrupted.
# 是否清空并重建回补窗口内的数据（用于升级后强制修复历史缓存）。
# 一般建议首次部署/升级后设置 true 跑完一次，之后改回 false。
BACKFILL_REBUILD=false
BACKFILL_CHUNK_MINUTES=60
BACKFILL_REQUEST_PAUSE_MS=250

# ------------------------------
# Optional: Orderbook heatmap ("liquidity surface")
# ------------------------------
# Enable periodic binned depth snapshots so you can build a heatmap externally.
HEATMAP_ENABLED=false
# Default metadata lookback (minutes) when querying via MCP tool
HEATMAP_LOOKBACK_MINUTES=180
# Snapshot interval (seconds)
HEATMAP_INTERVAL_SEC=60
# Metadata sampler interval (milliseconds) for coverage/staleness info
HEATMAP_SAMPLE_INTERVAL_MS=15000
# Price bin size in quote units (USDT). For BTCUSDT, 10 means "10 USDT per bin".
HEATMAP_BIN_TICKS=10
# Depth range around mid price to bin (percent)
HEATMAP_DEPTH_PERCENT=1.0
